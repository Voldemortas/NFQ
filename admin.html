<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Administravimas</title>
    </head>
    <body>
        <button onclick="load().catch(wrong)">Užkrauti duomenis</button>
        <button onclick="remove()">Ištrinti duomenis</button>
        <div id="message"></div>
        <div id="data"></div>
        <script>
            'use strict'
            /**
             * localStorage item pavadinimas
             */
            const name = 'clients'
            let storage = localStorage.getItem(name)
            /**
             * @type {Array.<{id: Number, subject: String, time: Number}>}
             */
            let data = []
            function init() {
                if (storage != null) {
                    data = JSON.parse(storage)
                }
                document.getElementById('data').innerHTML =
                    data.length == 0
                        ? 'Duomenų nėra'
                        : 'Esami duomenys: ' +
                          data
                              .map(
                                  e =>
                                      (e.id + '').padStart(3, 0) +
                                      ` ${e.time} ${e.subject}`
                              )
                              .join('<br />')
            }
            async function load() {
                let input = await fetch('backend/clients.js')
                let data = await input.json()
                localStorage = data
                document.getElementById('message').innerHTML =
                    'Duomenys sėkmingai užkrauti'
                init()
            }
            function wrong() {
                document.getElementById('message').innerHTML =
                    'Duomenų nepavyko užkrauti'
                init()
            }
            function remove() {
                localStorage.removeItem(name)
                document.getElementById('message').innerHTML =
                    'Duomenys sėkmingai ištrinti'
                init()
            }
        </script>
    </body>
</html>
